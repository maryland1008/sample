(function(i){var y=(i.browser.msie?"paste":"input")+".mask",z=window.orientation!=undefined;i.mask={definitions:{"9":"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"}};i.fn.extend({caret:function(g,f){if(this.length!=0)if(typeof g=="number"){f=typeof f=="number"?f:g;return this.each(function(){if(this.setSelectionRange){this.focus();this.setSelectionRange(g,f)}else if(this.createTextRange){var d=this.createTextRange();d.collapse(true);d.moveEnd("character",f);d.moveStart("character",g);d.select()}})}else{if(this[0].setSelectionRange){g=
this[0].selectionStart;f=this[0].selectionEnd}else if(document.selection&&document.selection.createRange){var o=document.selection.createRange();g=0-o.duplicate().moveStart("character",-1E5);f=g+o.text.length}return{begin:g,end:f}}},unmask:function(){return this.trigger("unmask")},mask:function(g,f){if(!g&&this.length>0){var o=i(this[0]),d=o.data("tests");return i.map(o.data("buffer"),function(l,n){return d[n]?l:null}).join("")}f=i.extend({placeholder:"_",completed:null},f);var v=i.mask.definitions;
d=[];var p=g.length,s=null,k=g.length;i.each(String(g).split(""),function(l,n){if(n=="?"){k--;p=l}else if(v[n]){d.push(RegExp(v[n]));if(s==null)s=d.length-1}else d.push(null)});return this.each(function(){function l(a){for(;++a<=k&&!d[a];);return a}function n(a){var b=i(this).caret();a=a.keyCode;t=a<16||a>16&&a<32||a>32&&a<41;if(b.begin-b.end!=0&&(!t||a==8||a==46))x(b.begin,b.end);if(a==8||a==46||z&&a==127){for(b=b.begin+(a==46?0:-1);!d[b]&&--b>=0;);for(a=b;a<k;a++)if(d[a]){j[a]=f.placeholder;var c=
l(a);if(c<k&&d[a].test(j[c]))j[a]=j[c];else break}u();e.caret(Math.max(s,b));return false}else if(a==27){e.val(w);e.caret(0,q());return false}}function A(a){if(t){t=false;return a.keyCode==8?false:null}a=a||window.event;var b=a.charCode||a.keyCode||a.which,c=i(this).caret();if(a.ctrlKey||a.altKey||a.metaKey)return true;else if(b>=32&&b<=125||b>186){a=l(c.begin-1);if(a<k){b=String.fromCharCode(b);if(d[a].test(b)){c=a;for(var h=f.placeholder;c<k;c++)if(d[c]){var m=l(c),r=j[c];j[c]=h;if(m<k&&d[m].test(r))h=
r;else break}j[a]=b;u();a=l(a);i(this).caret(a);f.completed&&a==k&&f.completed.call(e)}}}return false}function x(a,b){for(var c=a;c<b&&c<k;c++)if(d[c])j[c]=f.placeholder}function u(){return e.val(j.join("")).val()}function q(a){for(var b=e.val(),c=-1,h=0,m=0;h<k;h++)if(d[h]){for(j[h]=f.placeholder;m++<b.length;){var r=b.charAt(m-1);if(d[h].test(r)){j[h]=r;c=h;break}}if(m>b.length)break}else if(j[h]==b[m]&&h!=p){m++;c=h}if(!a&&c+1<p){e.val("");x(0,k)}else if(a||c+1>=p){u();a||e.val(e.val().substring(0,
c+1))}return p?h:s}var e=i(this),j=i.map(g.toString().split(""),function(a){if(a!="?")return v[a]?f.placeholder:a}),t=false,w=e.val();e.data("buffer",j).data("tests",d);e.attr("readonly")||e.one("unmask",function(){e.unbind(".mask").removeData("buffer").removeData("tests")}).bind("focus.mask",function(){w=e.val();var a=q();u();setTimeout(function(){a==g.length?e.caret(0,a):e.caret(a)},0)}).bind("blur.mask",function(){q();e.val()!=w&&e.change()}).bind("keydown.mask",n).bind("keypress.mask",A).bind(y,
function(){setTimeout(function(){e.caret(q(true))},0)});q()})}})})(jQuery);
